(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{387:function(e,t,n){"use strict";n.r(t);var r=n(18),o=Object(r.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("Today, we're happy to announce that all newly-deployed BTCPay Server instances running "),t("strong",[e._v("1.0.3.138")]),e._v(" and up, using LND as a lightning implementation, will be provisioned with a recovery seed for an on-chain wallet and static channel backups. This is a big improvement towards securing your funds in case of a problem.")]),e._v(" "),t("p",[e._v("Furthermore, we're introducing "),t("strong",[e._v("a migration tool")]),e._v(" for old legacy deployments that allows easy migration from "),t("code",[e._v("noseedbackup=1")]),e._v(". Old deployments won't be forced to migrate. They can continue to run LND with legacy option.")]),e._v(" "),t("h2",{attrs:{id:"the-history-behind-the-issue"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#the-history-behind-the-issue"}},[e._v("#")]),e._v(" The history behind the issue")]),e._v(" "),t("p",[e._v("Every time LND is started it expects user intervention (init on first run, wallet unlock on every subsequent run). This obviously works in certain settings: if you are a mobile wallet, it's reasonable to expect that user will unlock LND through GUI on every restart. But if you are running LND as part of tech stack, it's quite obvious you are not going to "),t("code",[e._v("ssh")]),e._v(" into every server during every cluster restart and unlock LND.")]),e._v(" "),t("p",[e._v("Those with prerequisite knowledge have already found ways to automate this task, but large part of BTCPayServer audience are merchants who can't worry about "),t("code",[e._v("ssh")]),e._v(" and unlocking LND on their web server.")]),e._v(" "),t("p",[e._v("So, back when we initially did LND integration (version 0.4.1), "),t("code",[e._v("noseedbackup=1")]),e._v(" served our purpose. There was no real downside to using it - LND would restart without intervention & instead of seed backup we suggested users do more complete backup of whole LND data directory from docker container and that was it. Furthermore, we believed that providing users with an on-chain wallet backup, without providing backups for channels would create a false sense of security, since in most cases, the majority of user's funds would be in the channels.")]),e._v(" "),t("p",[e._v("Fast forward a year and half, LND has functionality like static channel backup that depends seed presence. We have legacy installations that we can't force update to version with seed. So what we needed to do is keep old versions and have them keep working, while initializing new installations without "),t("code",[e._v("noseedbackup=1")]),e._v(" and have them auto-init and unlock on every restart.")]),e._v(" "),t("h2",{attrs:{id:"how-to-migrate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#how-to-migrate"}},[e._v("#")]),e._v(" How to migrate?")]),e._v(" "),t("p",[e._v("A few notes:")]),e._v(" "),t("ol",[t("li",[e._v("The instructions "),t("em",[e._v("are "),t("strong",[e._v("only")])]),e._v(" for users using "),t("strong",[e._v("LND")]),e._v(" as their lightning implementation.")]),e._v(" "),t("li",[e._v("All legacy installations will keep working without intervention. It's not required, but recommended to migrate.")]),e._v(" "),t("li",[e._v("Users who deployed a fresh BTCPay instance from 1.0.3.138 and up will be running new versions with a seed.")])]),e._v(" "),t("p",[e._v("IMPORTANT WARNING! REALLY IMPORTANT, DO NOT SKIP THIS NICE BOX.")]),e._v(" "),t("p",[e._v("If you're running a legacy version and decided to migrate, before proceeding, make sure to "),t("strong",[e._v("close all your lightning channels")]),e._v(".")]),e._v(" "),t("p",[e._v("Channels can be closed through:")]),e._v(" "),t("p",[e._v("• "),t("a",{attrs:{href:"https://github.com/JeffVandrewJr/patron/blob/master/SSH.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("SSH"),t("OutboundLink")],1),e._v(" with "),t("code",[e._v("bitcoin-lncli.sh closeallchannels")]),e._v("\n• Server Setting > Services > LND (Ride the Lightning server)\n• External wallet that's connected to your LND node, such as Zap.")]),e._v(" "),t("p",[e._v("Once the channels are closed, it takes time for all the funds to settle. When there are no pending channels and all funds are visible on-chain, send them to an external wallet you have. For spending, you can use command line, RTL, Zap or other external wallet connected to your BTCPay.")]),e._v(" "),t("p",[e._v("If at any point you need assistance, visit our "),t("a",{attrs:{href:"https://chat.btcpayserver.org/btcpayserver/channels/lightning",target:"_blank",rel:"noopener noreferrer"}},[e._v("community chat"),t("OutboundLink")],1),e._v(" and ask a question in the "),t("a",{attrs:{href:"https://chat.btcpayserver.org/btcpayserver/channels/lightning",target:"_blank",rel:"noopener noreferrer"}},[e._v("#Lightning"),t("OutboundLink")],1),e._v(" channel.")]),e._v(" "),t("p",[e._v("When funds are SAFU, the migration process can begin. The migration tool for old installations will essentially stop all the services, delete the volume of the old LND container, restart the services and recreate a new LND with seed.")]),e._v(" "),t("p",[e._v("Log in into your machine through "),t("a",{attrs:{href:"https://github.com/JeffVandrewJr/patron/blob/master/SSH.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("SSH"),t("OutboundLink")],1),e._v(" and input the following command.")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("su")]),e._v(" -\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" btcpayserver-docker/Tools/lnd\n./lnd_recreate_volume.sh\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("p",[e._v("You will be prompted a few times to confirm running the tool, by typing "),t("code",[e._v("yes")]),e._v(" in the terminal. When the script is done, go to your BTCPayServer. Server Settings > Services > "),t("strong",[e._v("LND Seed Backup")]),e._v(".")]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/Services-LND-Seed-Backup.jpg",alt:""}})]),e._v(" "),t("p",[e._v("Safely backup and store your recovery seed. The seed is a backup of your on-chain Lightning wallet, but is also necessary to perform static channel backups.")]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/LND-With-Seed-Example-1024x471.jpg",alt:""}})]),e._v(" "),t("p",[e._v("If you backed it up safely you can remove it from the server.")]),e._v(" "),t("p",[e._v("That's it now you have a backup for your LND. Go ahead, get some "),t("a",{attrs:{href:"https://lnbig.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("inbound liquidity"),t("OutboundLink")],1),e._v(" to your brand new node and enjoy.")]),e._v(" "),t("h2",{attrs:{id:"static-channel-backup-optional"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#static-channel-backup-optional"}},[e._v("#")]),e._v(" Static channel backup (optional)")]),e._v(" "),t("p",[e._v("TIP")]),e._v(" "),t("p",[e._v("Perform this step only when you want to back up your channels. Do not do it immediately after doing the steps above, since you have no channels to back up.")]),e._v(" "),t("p",[e._v("For backing up "),t("strong",[e._v("funds in the channels")]),e._v(" the Static Channel Backup is needed which will result into remote "),t("strong",[e._v("force closures")]),e._v(" when you restore the backup, returning the off-chain fund to the on-chain wallet.")]),e._v(" "),t("p",[e._v("The SCB can be obtained through the "),t("a",{attrs:{href:"https://blog.btcpayserver.org/ride-the-lightning-btcpay/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Ride The Lightning App"),t("OutboundLink")],1),e._v(" and it's stored in the BTCPay filesystem.")]),e._v(" "),t("p",[e._v("To perform a SCB:")]),e._v(" "),t("ol",[t("li",[e._v("Server Setting > Services > LND (Ride the Lightning server)")]),e._v(" "),t("li",[e._v("Channels > Backup > "),t("strong",[e._v("Backup")])])]),e._v(" "),t("p",[e._v("Now, both your on-chain and funds in channels are backed up. For more information on recovery and restoring from the backup, "),t("a",{attrs:{href:"https://github.com/lightningnetwork/lnd/blob/master/docs/recovery.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("check LND documentation."),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"thank-you"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#thank-you"}},[e._v("#")]),e._v(" Thank you")]),e._v(" "),t("p",[e._v("The biggest attribution goes to "),t("a",{attrs:{href:"https://twitter.com/r0ckstardev/",target:"_blank",rel:"noopener noreferrer"}},[e._v("RockstarDev"),t("OutboundLink")],1),e._v(" who took over the entire task on himself and coded the migration tool and coordinated the entire testing process.")]),e._v(" "),t("p",[e._v("Thanks to "),t("a",{attrs:{href:"https://twitter.com/NicolasDorier",target:"_blank",rel:"noopener noreferrer"}},[e._v("@NicolasDorier"),t("OutboundLink")],1),e._v(" for idea; "),t("a",{attrs:{href:"https://twitter.com/MrKukks",target:"_blank",rel:"noopener noreferrer"}},[e._v("@MrKukks"),t("OutboundLink")],1),e._v(" and "),t("a",{attrs:{href:"https://twitter.com/pavlenex",target:"_blank",rel:"noopener noreferrer"}},[e._v("@pavlenex"),t("OutboundLink")],1),e._v(" for thorough review and testing. Credit also "),t("a",{attrs:{href:"https://twitter.com/junderwood4649",target:"_blank",rel:"noopener noreferrer"}},[e._v("@junderwood4649"),t("OutboundLink")],1),e._v(" "),t("a",{attrs:{href:"https://twitter.com/maltokyo",target:"_blank",rel:"noopener noreferrer"}},[e._v("@maltokyo"),t("OutboundLink")],1),e._v(" "),t("a",{attrs:{href:"https://twitter.com/ketominer",target:"_blank",rel:"noopener noreferrer"}},[e._v("@ketominer"),t("OutboundLink")],1),e._v(" "),t("a",{attrs:{href:"https://twitter.com/roasbeef",target:"_blank",rel:"noopener noreferrer"}},[e._v("@roasbeef"),t("OutboundLink")],1),e._v(" "),t("a",{attrs:{href:"https://twitter.com/bitconner",target:"_blank",rel:"noopener noreferrer"}},[e._v("@bitconner"),t("OutboundLink")],1),e._v(" "),t("a",{attrs:{href:"https://twitter.com/woutersamaey",target:"_blank",rel:"noopener noreferrer"}},[e._v("@woutersamaey"),t("OutboundLink")],1),e._v(" "),t("a",{attrs:{href:"https://twitter.com/openoms",target:"_blank",rel:"noopener noreferrer"}},[e._v("@openoms"),t("OutboundLink")],1),e._v(" "),t("a",{attrs:{href:"https://twitter.com/21isenough/",target:"_blank",rel:"noopener noreferrer"}},[e._v("@21isenough"),t("OutboundLink")],1),e._v(" and others who helped throughout the process in various ways.")])])}),[],!1,null,null,null);t.default=o.exports}}]);