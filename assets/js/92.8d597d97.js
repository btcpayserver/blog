(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{432:function(e,t,i){"use strict";i.r(t);var n=i(18),o=Object(n.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("Recently, we published "),t("a",{attrs:{href:"https://blog.btcpayserver.org/case-study-hodlhodl-2023/",target:"_blank",rel:"noopener noreferrer"}},[e._v("a case study highlighting the success of the Baltic Honey Badger 2023"),t("OutboundLink")],1),e._v(" - a Bitcoin conference where all merchants exclusively used Bitcoin to facilitate payments for food and drinks.")]),e._v(" "),t("a",{staticClass:"ytEmbed",staticStyle:{"background-image":"url(https://img.youtube.com/vi/mDeuHh9gqQM/hqdefault.jpg)"},attrs:{href:"https://www.youtube.com/watch?v=mDeuHh9gqQM","data-id":"mDeuHh9gqQM"}},[t("iframe",{attrs:{title:"YouTube","data-src":"https://www.youtube-nocookie.com/embed/mDeuHh9gqQM?&autoplay=1&autohide=1&modestbranding=1&color=white&rel=0",frameborder:"0",allow:"autoplay;encrypted-media;picture-in-picture",allowfullscreen:""}})]),e._v(" "),t("p",[e._v("In this post, we're diving behind the scenes of what happened. We'll provide a step-by-step guide on how you can replicate this – by setting up a BTCPay Server and providing individual stores for each merchant.")]),e._v(" "),t("p",[e._v("All technology necessary for this setup is under MIT license, and code is fully available on GitHub:")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/btcpayserver/btcpayserver",target:"_blank",rel:"noopener noreferrer"}},[e._v("BTCPay repositories"),t("OutboundLink")],1),e._v(" contain the code for Server itself")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/Kukks/BTCPayServerPlugins/",target:"_blank",rel:"noopener noreferrer"}},[e._v("MrKukks Plugins repository"),t("OutboundLink")],1),e._v(" contains code for Prism and Sideshift plugins we’ll use")])]),e._v(" "),t("h2",{attrs:{id:"video-guide"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#video-guide"}},[e._v("#")]),e._v(" Video Guide")]),e._v(" "),t("p",[e._v("If you would rather watch a video than read a blog post, you're in luck! You can watch Rockstar Dev execute the instructions from this video and show the setup in action.")]),e._v(" "),t("a",{staticClass:"ytEmbed",staticStyle:{"background-image":"url(https://img.youtube.com/vi/VwqobYi5nvw/hqdefault.jpg)"},attrs:{href:"https://www.youtube.com/watch?v=VwqobYi5nvw","data-id":"VwqobYi5nvw"}},[t("iframe",{attrs:{title:"YouTube","data-src":"https://www.youtube-nocookie.com/embed/VwqobYi5nvw?&autoplay=1&autohide=1&modestbranding=1&color=white&rel=0",frameborder:"0",allow:"autoplay;encrypted-media;picture-in-picture",allowfullscreen:""}})]),e._v(" "),t("h2",{attrs:{id:"launch-your-btcpay-server-instance"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#launch-your-btcpay-server-instance"}},[e._v("#")]),e._v(" Launch Your BTCPay Server Instance")]),e._v(" "),t("p",[e._v("Before anything else, you’ll need to ensure you have a BTCPay Server instance running. Fortunately, several reputable hosting providers now provide wizards that make this very easy. Our "),t("a",{attrs:{href:"https://docs.btcpayserver.org/Deployment/webdeployment/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Deploying BTCPay Server documentation"),t("OutboundLink")],1),e._v(" lists six noteworthy options:")]),e._v(" "),t("ul",[t("li",[e._v("LunaNode")]),e._v(" "),t("li",[e._v("Voltage Cloud")]),e._v(" "),t("li",[e._v("Clovyr")]),e._v(" "),t("li",[e._v("Dream Lab Network")]),e._v(" "),t("li",[e._v("Azure")]),e._v(" "),t("li",[e._v("Google Cloud")])]),e._v(" "),t("p",[e._v("For the purposes of this guide, we'll use LunaNode. It’s "),t("a",{attrs:{href:"https://docs.btcpayserver.org/Deployment/LunaNode/",target:"_blank",rel:"noopener noreferrer"}},[e._v("the oldest web wizard that supports BTCPay Server deployments"),t("OutboundLink")],1),e._v(", all for a reasonable monthly fee of around $15.")]),e._v(" "),t("p",[e._v("Start by registering an account with LunaNode. Create your API keys, then proceed to "),t("a",{attrs:{href:"https://launchbtcpay.lunanode.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://launchbtcpay.lunanode.com"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("Our "),t("a",{attrs:{href:"https://docs.btcpayserver.org/Deployment/LunaNode/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Deploying BTCPay - LunaNode Web-Wizard"),t("OutboundLink")],1),e._v(" article will guide you through the remaining deployment steps.")]),e._v(" "),t("h2",{attrs:{id:"account-creation-and-plugin-installation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#account-creation-and-plugin-installation"}},[e._v("#")]),e._v(" Account Creation and Plugin Installation")]),e._v(" "),t("p",[e._v("With your instance now active and ready, create the main administrative "),t("a",{attrs:{href:"https://docs.btcpayserver.org/RegisterAccount/",target:"_blank",rel:"noopener noreferrer"}},[e._v("account"),t("OutboundLink")],1),e._v(" and log in. Upon this being successful completed, you'll be prompted to "),t("a",{attrs:{href:"https://docs.btcpayserver.org/CreateStore/",target:"_blank",rel:"noopener noreferrer"}},[e._v("create a store"),t("OutboundLink")],1),e._v(". Use this store as your primary one - for demonstration and initial testing. This way you can ensure you're familiar with the system before onboarding the merchants.")]),e._v(" "),t("p",[e._v("Next, turn your attention to the necessary plugins. Navigate to the 'Manage Plugins' page and install the following:")]),e._v(" "),t("ul",[t("li",[e._v("LN Prism plugin (version 1.1.18 or higher)")]),e._v(" "),t("li",[e._v("SideShift plugin (version 1.1.7 or higher)")])]),e._v(" "),t("p",[e._v("Once you've added these plugins, you'll be prompted to restart the server. Kindly do so to ensure the changes take effect.")]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/case-study-technical-prism-sideshift/01_installing_prism_sideshift_plugin.png",alt:""}})]),e._v(" "),t("h2",{attrs:{id:"setting-up-your-demo-store"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-your-demo-store"}},[e._v("#")]),e._v(" Setting Up Your Demo Store")]),e._v(" "),t("p",[e._v("To make certain your the upcoming setup operates smoothly, a few configurations are required:")]),e._v(" "),t("p",[e._v("Access the 'Settings -> Rates' and configure the spread to around 2%. This adjustment aims to cover Sideshift transaction fees.")]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/case-study-technical-prism-sideshift/02_setting_up_store_settings_rates.png",alt:""}})]),e._v(" "),t("p",[e._v("Furthermore, visit 'Settings > Payout Processors'. Here, configure the Payout Processor for Lightning and activate the 'Process approved payouts instantly' option. If you're looking to have faster retries in the event of a hiccup, you can set the interval to less than 60 minutes.")]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/case-study-technical-prism-sideshift/03_automated_payment_processors_offchain.png",alt:""}})]),e._v(" "),t("h2",{attrs:{id:"harnessing-the-power-of-lightning-payments"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#harnessing-the-power-of-lightning-payments"}},[e._v("#")]),e._v(" Harnessing the Power of Lightning Payments")]),e._v(" "),t("p",[e._v("Each BTCPay Server comes with an integrated Lightning node, empowering you to accept Bitcoin via Lightning. But to actually start doing receiving sats - you would need to open channels and manage incoming liquidity.")]),e._v(" "),t("p",[e._v("That's precisely why BTCPay provides support for connecting to remote nodes using different standards. For this guide we will use LNDHub to connect to Alby account. This approach is beneficial for those less tech-savvy - merchants can quickly get setup, sidestepping complexities of the Lightning network.")]),e._v(" "),t("p",[e._v("Here's how you can set it up:")]),e._v(" "),t("ol",[t("li",[e._v("Have merchants visit "),t("a",{attrs:{href:"https://getalby.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://getalby.com"),t("OutboundLink")],1),e._v(" and register an account.")]),e._v(" "),t("li",[e._v("After logging in, they need to head over to the Wallet page at "),t("a",{attrs:{href:"https://getalby.com/node",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://getalby.com/node"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("li",[e._v("Scroll to the 'Wallet Connection Credentials' section and select \"Show your connection credentials.\"")]),e._v(" "),t("li",[e._v("This action will provide you with an LNDHub connection string. Copy this string.")]),e._v(" "),t("li",[e._v("Paste this string into the Lightning settings section of your BTCPay Server Demo Store.")])]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/case-study-technical-prism-sideshift/04_lndhub_alby.png",alt:""}})]),e._v(" "),t("p",[e._v("Voila! Merchants are now set to receive lightning payments, while Alby handles the details of managing liquidity since their node is being utilized.")]),e._v(" "),t("p",[e._v("It is worthy to note that you as the administrator of the BTCPay Server will have access to funds in the merchant's Alby account through the LNDHub connection string.")]),e._v(" "),t("p",[e._v("This is why in the next step we will set up a Prism. The idea being that Bitcoin remains on Alby only until it reaches a certain threshold (we suggest 100,000 sats). Once this amount accrues, it should get forwarded to a destination under the merchant's (could be another lightning address).")]),e._v(" "),t("h2",{attrs:{id:"setting-up-a-wallet-for-stablecoins-creating-a-prism-destination-for-conversion"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-a-wallet-for-stablecoins-creating-a-prism-destination-for-conversion"}},[e._v("#")]),e._v(" Setting Up a Wallet for Stablecoins & Creating a Prism Destination for Conversion")]),e._v(" "),t("p",[e._v("When it comes to merchants at events, there's often a common concern: hedging against the wild swings of price volatility. Even those that are game for holding onto Bitcoin earnings, want to ensure that when it comes to fixed costs of their vendors, they are covered on every sale.")]),e._v(" "),t("p",[e._v("In this guide we will showcase how Prism can be setup so that:")]),e._v(" "),t("ul",[t("li",[e._v("80% of incoming sats will be converted to stablecoin")]),e._v(" "),t("li",[e._v("10% will be sent to another lightning address")]),e._v(" "),t("li",[e._v("10% will stay on the server for demo purposes")])]),e._v(" "),t("p",[e._v("We first need to set up a wallet for stablecoins. We will be using Blockstream Green to accept Liquid USDT. Download it for:")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://play.google.com/store/apps/details?id=com.greenaddress.greenbits_android_wallet&hl=en_US&gl=US",target:"_blank",rel:"noopener noreferrer"}},[e._v("Green: Bitcoin Wallet for Android"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://apps.apple.com/us/app/green-bitcoin-wallet/id1402243590",target:"_blank",rel:"noopener noreferrer"}},[e._v("Green: Bitcoin Wallet for iOS"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("Once you install the wallet, ensure that seed phrase is backed up. Then tap on the Receive button and switch asset to Liquid Tether USD. You will get an address that can now be utilized for accepting stablecoins.")]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/case-study-technical-prism-sideshift/05_green_wallet_liquid_usdt.png",alt:""}})]),e._v(" "),t("p",[e._v("Before we proceed further we need to generate a Sideshift destination which will convert 80% of incoming sats into USDT on Liquid. An important caveat here is that both your location and the BTCPay Server's hosting site need to be outside of the US. SideShift's operations don't extend to US territories, and attempting access will trigger an 'Access denied' notification.")]),e._v(" "),t("p",[e._v("Beyond that, be aware that each conversion incurs around 2% for Sideshift fee + on-chain transaction fee . So for every 1000 sats, you’ll be paying 20 in order for merchants to receive stablecoin in their Green Wallet.")]),e._v(" "),t("p",[e._v("On top of that you need to be aware of Lightning routing fees. Alby right now doesn’t take any percentage for incoming payments, but while forwarding sats from Alby node to Sideshift - you may see ~0.5% fees charged depending on channels used. We’ll talk more about this in the following sections - where we will also be able to configure maximum fees we’re willing to pay.")]),e._v(" "),t("p",[e._v("For now - let’s get back to setup:")]),e._v(" "),t("ol",[t("li",[e._v("Navigate to Prism Plugin page and click on "),t("strong",[e._v("Generation Sideshift destination")]),e._v(" button")]),e._v(" "),t("li",[e._v("Select Tether (liquid) from the “Which coin should Sideshift send you” dropdown")]),e._v(" "),t("li",[e._v("Enter Liquid USDT receiving address you got from Green wallet")]),e._v(" "),t("li",[e._v("Click on Generate code")])]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/case-study-technical-prism-sideshift/06_generate_sideshift_destination.png",alt:""}})]),e._v(" "),t("p",[e._v("You'll receive an LNURL address, specifically designed for upcoming swaps. Make sure to copy both the LNURL address and the SideShift order URL, and store them in a safe place for later use.")]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/case-study-technical-prism-sideshift/06_generate_sideshift_destination_lnurl.png",alt:""}})]),e._v(" "),t("h2",{attrs:{id:"setting-up-prism"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-prism"}},[e._v("#")]),e._v(" Setting up Prism")]),e._v(" "),t("p",[e._v("Now it’s time to complete the configuration of Prism:")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Click on the Add Prism button.")])]),e._v(" "),t("li",[t("p",[e._v("Set the source to *. This ensures that prism manages all LN payments to the store")])]),e._v(" "),t("li",[t("p",[e._v("Navigate to the "),t("strong",[e._v("Select destination to configure")]),e._v(" dropdown and select "),t("strong",[e._v("Create new destination")])]),e._v(" "),t("ol",[t("li",[t("strong",[e._v("Destination Id")]),e._v(": Input any desired alias for this destination.")]),e._v(" "),t("li",[t("strong",[e._v("Destination")]),e._v(": Enter the LNURL address you obtained from Sideshift.")]),e._v(" "),t("li",[t("strong",[e._v("Sat Threshold")]),e._v(": Check the minimums for conversion at the chosen Sideshift destination. Given the current transaction fee market, consider setting it between 50,000 and 100,000 sats.")]),e._v(" "),t("li",[t("strong",[e._v("Reserve fee")]),e._v(": in percentage. This depends on the channels from your LN wallet. If you boast a robust liquidity route to Sideshift, you can set this as low as 0. This is what we talked about in the previous section about Lightning fees. For this guide, we’ll set it at 1.")])])])]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/case-study-technical-prism-sideshift/07_creating_prism_destination.png",alt:""}})]),e._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[t("p",[e._v("We can do the same for lightning address, create another destination using this data:")]),e._v(" "),t("ol",[t("li",[e._v("Id: OpenSats")]),e._v(" "),t("li",[e._v("Destination: "),t("a",{attrs:{href:"mailto:opensats@vlt.ge"}},[e._v("opensats@vlt.ge")])]),e._v(" "),t("li",[e._v("Sat threshold: 10,000")]),e._v(" "),t("li",[e._v("Reserve fee: 1")])])]),e._v(" "),t("li",[t("p",[e._v("Click "),t("strong",[e._v("Add")]),e._v(" under the "),t("strong",[e._v("Destination")]),e._v(" section")]),e._v(" "),t("ol",[t("li",[e._v("Choose the Sideshift destination and set the percentage to 80%")]),e._v(" "),t("li",[e._v("Click Add under Destination once more")]),e._v(" "),t("li",[e._v("This time, select the OpenSats destination and set the percentage to 10%")])])]),e._v(" "),t("li",[t("p",[e._v("To activate Prism, tick the "),t("strong",[e._v("Enabled")]),e._v(" checkbox at the top")])]),e._v(" "),t("li",[t("p",[e._v("Lastly, click "),t("strong",[e._v("Save")]),e._v(" button at the bottom")])])]),e._v(" "),t("p",[e._v("Your Prism is now set, and you're primed to accept Lightning payments and redirect them to various destinations.")]),e._v(" "),t("h2",{attrs:{id:"test-your-payments-with-point-of-sale-app"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#test-your-payments-with-point-of-sale-app"}},[e._v("#")]),e._v(" Test your payments with Point of Sale app")]),e._v(" "),t("p",[e._v("To experience firsthand the system you've set up, head over to the "),t("strong",[e._v("Point of Sale")]),e._v(" plugin and create a new POS. For the sake of this demonstration, the only modification we'll undertake is opting for the Keypad view, to have flexibility in testing various payment amounts.")]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/case-study-technical-prism-sideshift/08_configure_point_of_sale_app.png",alt:""}})]),e._v(" "),t("p",[e._v("Once inside the View, key in a dollar amount of your choice to test payments. To keep it simple, enter an amount that surpasses the minimum sats threshold you've predefined for forwarding. This way, you avoid the need to execute multiple payments to witness Prism in action.")]),e._v(" "),t("p",[e._v("All Prism's forwarding activities can be easily tracked under "),t("strong",[e._v("Off-Chain Payouts")]),e._v(", accessible via the "),t("strong",[e._v("Payouts")]),e._v(" menu on the left. Also, keep an eye out for notifications which pop up next to the bell icon. Here's a sneak peek into how your Prism forwarding list might appear:")]),e._v(" "),t("figure",[t("img",{attrs:{src:"/images/case-study-technical-prism-sideshift/09_offchain_payouts.png",alt:""}})]),e._v(" "),t("h2",{attrs:{id:"conclusion"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),t("p",[e._v("The showcased setup allows you to easily onboard any number of merchants with a single instance of BTCPay Server, and provide them with technology necessary to accept Bitcoin payments and stablecoins. Again - we recommend that you set up Prisms to forward to merchant’s custody with minimal, practical amounts that work in your fee market.")]),e._v(" "),t("p",[e._v("Reflecting on our real-world application of this setup at the Baltic Honey Badger 2023 event in Riga, it's noteworthy to mention that onboarding 20 merchants didn't place any discernible load on the server. Seemingly we could’ve handled orders of magnitude more without any problems.")]),e._v(" "),t("p",[e._v("If you decide to implement this setup for your event, we would love to hear from you! Especially if you venture beyond the 20-merchant mark that we have set. We would love to create and showcase a list of all those that have helped in the battle of taking payment volumes over from legacy fiat rails onto the Bitcoin Lightning network.")])])}),[],!1,null,null,null);t.default=o.exports}}]);